<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Local Storage</title>
        <style type="text/CSS">
            table {
                width: 90%;
                border-collapse: collapse;
                background-color: lightblue;
                font-family: Perpetua;
            }
            table, td, th {
                border: 1px solid black;
                padding: 4px;
            }
            th {
                text-align: center;
                color: white;
                background-color: darkblue;
            }
            tr.oddrow {
                background-color: white;
            }
            td {
                text-align: center;
            }
        </style>
    </head>
    <body>
        <a href="https://tokichan.github.io/webProgramming/index.html" >GitHub Link</a>
        <form action="#">
            <p>
                <label>Book Title:</label>
                <input id="title" type="text">
                <label>Author(s):</label>
                <input id="author" type="text">
                <label>Year:</label>
                <input id="year" type="number">
                <label>Book URL:</label>
                <input id="url" type="url">
            </p>
            <p>
                <input type="button" value="Add New Item" id="addButton">
                <input type="button" value="Remove All Items" id="removeAllButton">
            </p>
        </form>
        <hr>
        <div id="display">
        </div>
    </body>
    <script type="text/javascript">
        let currData = [];
        function refreshTable(){
            let table = "";
            table += "<table><thead><tr><th>title</th><th>author</th><th>year</th><th>url</th></tr></thead>";
            if(currData.length!=0){
                for(let index in currData){
                    table+="<tr>";
                    table+="<td>";
                    table+=currData[index].title;
                    table+="</td>";
                    table+="<td>";
                    table+=currData[index].author;
                    table+="</td>";
                    table+="<td>";
                    table+=currData[index].year;
                    table+="</td>";
                    table+="<td>";
                    table+="<a href="+currData[index].url+">"
                    table+=currData[index].url;
                    table+="</a>";
                    table+="</td>";
                    table+="</tr>";
                }
            }
            table+="</table>";
            display = document.getElementById("display");
            display.innerHTML = table;
        }

        function allStorage() {

            var values = [],
                keys = Object.keys(localStorage),
                i = keys.length;
            while ( i-- ) {
                if(keys[i].startsWith("ntou")){
                    values.push(localStorage.getItem(keys[i]));
                }
            }
            return values;
        }

        function readData(){
            let jsonData = allStorage();
            currData=[];
            for(let index in jsonData){
                let temp = JSON.parse(jsonData[index]);
                currData.push(temp);
            }
            refreshTable();
        }

        function addItem(){
            let title = document.getElementById("title").value;
            let author = document.getElementById("author").value;
            let year = document.getElementById("year").value;
            let url = document.getElementById("url").value;
            let time = (new Date()).getTime().toString();
            let item = {title:title,author:author,year:year,url:url};
            jsonObj = JSON.stringify(item,null,'\t');
            console.log(jsonObj);
            localStorage.setItem("ntou-"+time,jsonObj);
            currData.push(item);
            refreshTable();
        }

        function removeAll(){
            display = document.getElementById("display");
            display.innerHTML = "";
            var values = [],
                keys = Object.keys(localStorage),
                i = keys.length;
            while ( i-- ) {
                if(keys[i].startsWith("ntou")){
                    localStorage.removeItem(keys[i]);
                }
            }
            window.alert("All items were removed!");
            currData = [];
            refreshTable()
        }
        let addButton = document.getElementById("addButton");
        addButton.addEventListener("click",addItem,false);
        let removeAllButton = document.getElementById("removeAllButton");
        removeAllButton.addEventListener("click",removeAll,false);
        window.addEventListener("load",readData,false);
    </script>
</html>